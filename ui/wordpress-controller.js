// Generated by CoffeeScript 1.6.2
(function() {
  var Montage, RangeController, Reqwest;

  Montage = require("montage").Montage;

  Reqwest = require("reqwest");

  RangeController = require("montage/core/range-controller").RangeController;

  exports.WordpressController = Montage.specialize({
    siteAddress: {
      value: null
    },
    queryPosts: {
      value: null
    },
    constructor: {
      value: function() {
        this.posts = [];
        return this.addOwnPropertyChangeListener("queryPosts", this);
      }
    },
    handleQueryPostsChange: {
      value: function(query) {
        var _this = this;

        if (query === null) {
          return;
        }
        return this.getPosts(query).then(function(output) {
          console.log(output);
          return _this.posts = output;
        });
      }
    },
    getPosts: {
      value: function(query) {
        var key, val, _ref;

        _ref = query != null ? query.filter : void 0;
        for (key in _ref) {
          val = _ref[key];
          query["filter[" + key + "]"] = val;
        }
        if (query != null) {
          delete query.filter;
        }
        return this.getRequest("posts", query);
      }
    },
    getRequest: {
      value: function(path, params) {
        var url;

        url = "http://" + this.siteAddress + "/wp-json.php/" + path;
        if (params) {
          url += "?" + Reqwest.toQueryString(params);
        }
        return Reqwest({
          url: url,
          type: "json",
          method: "get"
        });
      }
    }
  });

}).call(this);
